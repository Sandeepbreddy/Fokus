<!DOCTYPE html>
<html>

<head>
    <title>Focus Guard Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }

        .result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }

        input {
            padding: 8px;
            margin: 5px;
            width: 200px;
        }
    </style>
</head>

<body>
    <h1>üõ°Ô∏è Focus Guard Debug Test</h1>

    <div class="test-section">
        <h3>Extension Status</h3>
        <div id="extension-status">Loading...</div>
    </div>

    <div class="test-section">
        <h3>Blocked Keywords Test</h3>
        <p>Current blocked keywords:</p>
        <div id="keywords-list">Loading...</div>

        <p>Test keyword detection:</p>
        <input type="text" id="test-input" placeholder="Type 'porn' to test">
        <button onclick="testKeyword()">Test Keyword</button>
        <div id="keyword-result"></div>
    </div>

    <div class="test-section">
        <h3>Search URL Tests</h3>
        <button onclick="testGoogleSearch()">Test Google Search (porn)</button>
        <button onclick="testDirectURL()">Test Direct URL Navigation</button>
        <div id="url-result"></div>
    </div>

    <div class="test-section">
        <h3>Console Logs</h3>
        <p>Check browser console (F12) for detailed debug information.</p>
        <button onclick="clearConsole()">Clear Console</button>
    </div>

    <script>
        console.log('üîß Debug test page loaded');

        async function loadExtensionStatus()
        {
            try
            {
                const data = await chrome.storage.local.get(['blockedKeywords', 'isActive', 'customDomains']);

                const status = document.getElementById('extension-status');
                const keywordsList = document.getElementById('keywords-list');

                const isActive = data.isActive !== undefined ? data.isActive : true;
                const keywords = data.blockedKeywords || [];

                status.innerHTML = `
                    <div class="result ${isActive ? 'success' : 'error'}">
                        Extension Active: ${isActive ? 'YES' : 'NO'}
                    </div>
                    <div class="result info">
                        Blocked Keywords: ${keywords.length}
                    </div>
                    <div class="result info">
                        Custom Domains: ${(data.customDomains || []).length}
                    </div>
                `;

                keywordsList.innerHTML = keywords.length > 0 ?
                    keywords.map(k => `<span style="background: #e3f2fd; padding: 4px 8px; margin: 2px; border-radius: 4px; display: inline-block;">${k}</span>`).join('') :
                    '<div class="result error">No keywords configured!</div>';

            } catch (error)
            {
                document.getElementById('extension-status').innerHTML =
                    `<div class="result error">Error loading extension data: ${error.message}</div>`;
            }
        }

        function testKeyword()
        {
            const input = document.getElementById('test-input');
            const result = document.getElementById('keyword-result');
            const value = input.value.toLowerCase();

            console.log('üîß Testing keyword:', value);

            // Test against common blocked keywords
            const testKeywords = ['porn', 'xxx', 'sex', 'adult', 'nude', 'naked'];
            const found = testKeywords.find(k => value.includes(k));

            if (found)
            {
                result.innerHTML = `<div class="result error">‚ö†Ô∏è Keyword "${found}" detected in "${value}"</div>`;
                console.log('üö´ Keyword detected:', found);
            } else
            {
                result.innerHTML = `<div class="result success">‚úÖ No blocked keywords found in "${value}"</div>`;
                console.log('‚úÖ No keywords detected');
            }
        }

        function testGoogleSearch()
        {
            console.log('üîß Testing Google search navigation...');
            const result = document.getElementById('url-result');
            result.innerHTML = '<div class="result info">üîÑ Testing Google search URL...</div>';

            // Try to navigate to Google search
            const searchURL = 'https://www.google.com/search?q=porn&uact=5';
            console.log('üîß Navigating to:', searchURL);

            setTimeout(() =>
            {
                window.location.href = searchURL;
            }, 1000);
        }

        function testDirectURL()
        {
            console.log('üîß Testing direct URL navigation...');
            const result = document.getElementById('url-result');
            result.innerHTML = '<div class="result info">üîÑ Testing direct navigation...</div>';

            // Test URL that should be blocked
            window.location.href = 'https://www.google.com/search?q=adult+content&uact=5';
        }

        function clearConsole()
        {
            console.clear();
            console.log('üîß Console cleared - Debug test page ready');
        }

        // Load status on page load
        document.addEventListener('DOMContentLoaded', loadExtensionStatus);

        // Set up input testing
        document.getElementById('test-input').addEventListener('input', function ()
        {
            const value = this.value;
            if (value.includes('porn') || value.includes('sex') || value.includes('adult'))
            {
                this.style.border = '2px solid red';
                this.style.background = '#ffe6e6';
            } else
            {
                this.style.border = '';
                this.style.background = '';
            }
        });
    </script>
</body>

</html>